## 요구사항 분석

> ### 📑 목차
> - [잔액 충전 API](#잔액-충전-api)
> - [잔액 조회 API](#잔액-조회-api)
> - [상품 조회 API](#상품-조회-api)
> - [주문 API](#주문-api)
> - [결제 API](#결제-api)
> - [선착순 쿠폰 API](#선착순-쿠폰-api)
> - [인기 판매 상품 조회 API](#인기-판매-상품-조회-api)
---

### 잔액 충전 API
1. 사용자 식별자와 충전금액을 입력받는다.
2. 사용자 식별자를 통해 사용자의 잔액을 조회한 후 충전금액만큼 잔액을 충전시킨 후 충전된 잔액을 저장한다.
3. 충전된 잔액을 응답 값으로 전달한다.

> - 최대 잔고의 금액은 `1,000,000` 으로 한다.
> - 충전 금액이 양수가 아닌 경우 예외를 발생시킨다.
> - 잔고가 최대 금액을 초과한 경우 예외를 발생시킨다.
> - 동시에 여러 충전요청이 들어오는 경우 동시성 문제가 발생할 수 있다.

---

### 잔액 조회 API
1. 사용자 식별자를 통해 사용자의 잔액을 조회한다.
2. 조회한 사용자의 잔액을 반환한다.

---

### 상품 조회 API
1. 상품 목록 조회: `/api/product`
2. 상품 정보 조회: `/api/product/{product_id}`
3. 상품 식별자를 통해 상품 정보(ID, 이름, 가격, 잔여수량)를 조회한다.

> - 상품이 존재하지 않는 경우 예외를 발생시킨다.

---

### 주문 API
1. 상품정보를 조회한다.
2. 쿠폰을 사용하는 경우 쿠폰 조회하여 쿠폰을 검증한다.
3. 쿠폰이 유효하다면 할인을 적용한다.
4. 주문 정보를 생성한 후 재고를 차감을 한다.
5. 쿠폰 사용 처리를 한다.
6. 생성된 주문 정보를 사용자에게 응답한다.
7. 결제 정보를 저장한다.

> - 한 주문에는 쿠폰을 한 개만 사용할 수 있다.
> - 쿠폰이 유효하지 않은 경우 예외를 발생시킨다.
> - 재고가 부족한 경우 예외를 발생시키며, 주문 상태는 실패로 저장한다.
> - 동시에 여러 주문이 들어오는 경우 차감 시 동시성 문제가 발생할 수 있다.

---

### 결제 API
1. 주문 정보, 포인트 잔액 조회 후 포인트 차감한다.
2. 결제 상태와 주문 상태를 변경하고, 주문 정보를 데이터 플랫폼에 전송한다.
3. 결제 완료 정보를 응답한다.

> - 포인트가 부족한 경우 예외를 발생시킨다.
> - 포인트 차감, 결제 상태 변경, 주문 상태 변경이 모두 하나의 트랜잭션으로 처리해야 한다.
> - 데이터플랫폼에 주문정보를 전송하는것은 비동기적으로 처리해야 한다.
> - 동시에 여러 결제가 들어오는 경우 포인트 조회 및 차감 시 동시성 문제가 발생할 수 있다.

---

### 선착순 쿠폰 API
1. 쿠폰 발급을 요청한다.
2. 잔여 쿠폰이 있는지 조회한다.
3. 쿠폰을 생성한다.
4. 사용자에게 이미 발급된 쿠폰인지 조회한다.
5. 쿠폰을 저장한다.
6. 저장된 쿠폰을 응답한다.

> - 쿠폰이 모두 소진된 경우 예외를 발생시킨다.
> - 이미 쿠폰을 발급받은 사용자인 경우 예외를 발생시킨다.
> - 여러 사용자가 동시에 쿠폰을 요청할 경우를 동시성 문제가 발생할 수 있다.

---

### 인기 판매 상품 조회 API
1. 최근 3일간 가장 많이 팔린 상위 5개의 상품을 조회한다.
2. 조회된 상품 식별자들을 기반으로 상세 상품 정보를 조회한다.
3. 인기 판매 상품 정보를 사용자에게 응답한다.

> - 최근 3일 기준: 조회 시점으로 부터 72시간으로 한다.
> - 상위 5개 상품 기준: 총 주문 확정된 상품 상위 5개이며, 재고가 없어도 응답한다.
