## [요구사항 분석] Flowchart

> ### 📑 목차
> - [잔액 충전 API](#잔액-충전-api)
> - [잔액 조회 API](#잔액-조회-api)
> - [상품 조회 API](#상품-조회-api)
> - [주문 API](#주문-api)
> - [결제 API](#결제-api)
> - [선착순 쿠폰 API](#선착순-쿠폰-api)
> - [인기 판매 상품 조회 API](#인기-판매-상품-조회-api)
---

### 잔액 충전 API
```mermaid
flowchart TD
  A(사용자) --> B[잔액 충전 API 요청]
  B --> C{충전 금액 > 0?}
  C -- YES --> E[잔액 조회]
  C -- NO --> D(유효하지 않은 충전 금액 예외 발생)
  E --> F[잔액 충전]
  F --> G{최대 잔고 초과?}
  G -- YES --> H(잔고 최대 금액 초과 예외 발생) 
  G -- NO --> I[잔고 저장]
  I --> J(잔액 응답)
```
---

### 잔액 조회 API
```mermaid
flowchart TD
  A(사용자) --> B[잔액조회 API 요청]
  B --> C[잔액 조회]
  C --> D(잔액 응답)
```

---

### 상품 조회 API
```mermaid
flowchart TD
  A(사용자) --> B[상품조회 API 요청]
  B --> C{쿼리파라미터 존재?}
  C -- YES --> F[상품 정보 조회]
  F --> G(상품 정보 반환)
  C -- NO --> D[상품목록 조회]
  D --> E(상품목록 반환)
```

---

### 주문 API
```mermaid
flowchart TD
  A(사용자) --> B[주문 API 요청]
  B --> C[상품 정보 조회]
  C --> D{쿠폰 사용?}
  D -- YES --> E{유효한 쿠폰?}
  D -- NO --> I[주문 정보 생성]
  E -- YES--> G[쿠폰 할인 적용]
  E -- NO --> H(유효하지 않은 쿠폰 예외 발생)
  G --> I
  I --> J[재고 확인]
  J --> K{재고 여유?}
  K -- YES --> L[재고 차감]
  K -- NO --> M[주문 상태 실패 업데이트]
  M --> R(재고 부족 예외 발생)
  L --> N{쿠폰 사용?}
  N -- YES --> O[쿠폰 사용 처리]
  O --> P[결제정보 저장]
  N -- NO --> P
  P --> Q(주문 생성 정보 응답)
```

---

### 결제 API
```mermaid
flowchart TD
  A(사용자) --> B[결제 API 요청]
  B --> C[주문정보 조회]
  C --> D[포인트 조회]
  D --> E{포인트 부족?}
  E -- YES --> F(포인트 부족 예외 발생)
  E -- NO --> G[포인트 차감]
  G --> H[결제 상태 완료 처리]
  H --> I[주문 상태 완료 처리]
  I --> J[주문 정보 데이터 플랫폼 전송]
  J --> K(결제 완료 응답)
```

---

### 선착순 쿠폰 API
```mermaid
flowchart TD
  A(사용자) --> B[쿠폰 발급 API 요청]
  B --> C[잔여 쿠폰을 조회]
  C --> D{쿠폰 여유?}
  D -- YES --> E[쿠폰 생성]
  D -- NO --> F(쿠폰 소진 예외 발생)
  E --> G{이미 발급된 쿠폰?}
  G -- YES --> H[쿠폰 생성 취소]
  H --> I(기발급된 쿠폰 예외 발생)
  G -- NO --> J[쿠폰 저장]
  J --> K(쿠폰발급 완료 응답)
```

---

### 인기 판매 상품 조회 API
```mermaid
flowchart TD
  A(사용자) --> B[인기 판매 상품 조회 요청]
  B --> C[최근 3일간 가장 많이 팔린 상위 5개 ID 조회]
  C --> D[상위 ID기반 5개 상품 정보 조회]
  D --> E(인기 판매 상품 정보 반환)
```
